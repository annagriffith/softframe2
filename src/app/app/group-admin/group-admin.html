<!--
This file is the group admin panel template for the Frametry6 app.
It lets group admins create/manage groups, channels, and members.
Use this to answer questions about how group/channel management works in the project.
-->
<h1>Group Admin Panel</h1>
<div class="mb-4">
  <h3>Create Group</h3>
  <form (ngSubmit)="createGroup()" class="row g-2">
    <div class="col-auto">
      <input type="text" [(ngModel)]="newGroupName" name="groupName" class="form-control" placeholder="Group name" required>
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-success">Create Group</button>
    </div>
  </form>
</div>

<div class="mb-4">
  <h3>Groups</h3>
  <ul>
    <li *ngFor="let group of groups">
  <strong>{{ group.name }}</strong>
  <button *ngIf="currentUser?.role === 'superAdmin'" class="btn btn-danger btn-sm ms-2" (click)="deleteGroup(group.id)">Delete Group</button>
      <button class="btn btn-primary btn-sm ms-2" (click)="selectGroup(group.id)">Manage</button>
    </li>
  </ul>
</div>

<div *ngIf="selectedGroupId">
  <h3>Channels</h3>
  <form (ngSubmit)="createChannel()" class="row g-2 mb-2">
    <div class="col-auto">
      <input type="text" [(ngModel)]="newChannelName" name="channelName" class="form-control" placeholder="Channel name" required>
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-success">Create Channel</button>
    </div>
  </form>
  <ul>
    <li *ngFor="let channel of channels">
  {{ channel.name }}
  <a class="btn btn-sm btn-outline-primary ms-2" [routerLink]="['/chat', (channel.id || channel._id)]">Open</a>
  <button class="btn btn-danger btn-sm ms-2" (click)="deleteChannel(channel.id || channel._id)">Delete Channel</button>
      <div class="mt-1">
        <label class="form-label me-2">Add member to channel</label>
        <input class="form-control d-inline-block w-auto" [(ngModel)]="channelMemberToAdd[channel.id || channel._id]" placeholder="username">
        <button class="btn btn-sm btn-success ms-2" (click)="addChannelMember(channel.id || channel._id)">Add</button>
      </div>
    </li>
  </ul>

  <h3>Members</h3>
  <form (ngSubmit)="addMember()" class="row g-2 mb-2">
    <div class="col-auto">
      <label for="memberToAddSelect" class="form-label">Add Member</label>
      <select id="memberToAddSelect" [(ngModel)]="memberToAdd" name="memberToAdd" class="form-select" required title="Select user to add">
        <option value="" disabled selected>Select user to add</option>
        <option *ngFor="let user of users" [value]="user.username">{{ user.username }}</option>
      </select>
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-success">Add Member</button>
    </div>
  </form>
  <ul>
    <li *ngFor="let group of groups" [hidden]="group.id !== selectedGroupId">
      <ul>
        <li *ngFor="let member of group.memberIds">
          {{ member }}
          <button class="btn btn-danger btn-sm ms-2" (click)="removeMember(member)">Remove</button>
        </li>
      </ul>
    </li>
  </ul>
</div>
<div *ngIf="error" class="text-danger mt-2">{{ error }}</div>
<div *ngIf="success" class="text-success mt-2">{{ success }}</div>
